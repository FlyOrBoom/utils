const TOSSUP = 5 * 1000
const BONUS = 20 * 1000


const now = performance.now.bind(performance)

let time = TOSSUP
let prev = now()
let delta = 0

let interval

const $ = document.getElementById.bind(document)
const timer = $('timer')
const pause = $('pause')
const add = $('add')
const subtract = $('subtract')
const tossup = $('tossup')
const bonus = $('bonus')

add.call = () => time += 1000
subtract.call = () => time -= 1000
tossup.call = () => {
  tossup.checked = true
  time = TOSSUP
}
bonus.call = () => {
  bonus.checked = true
  time = BONUS
}

add.addEventListener('click',add.call)
subtract.addEventListener('click',subtract.call)

tossup.addEventListener('input',tossup.call)
bonus.addEventListener('input',bonus.call)

document.addEventListener('keydown', event => {
  console.log(event.key)
  switch(event.key){
    case ' ': pause.checked = !pause.checked 
      break
    case '1': tossup.call()
      break
    case '2': bonus.call()
      break
    case '+': case '=': add.call()
      break
    case '-': subtract.call()
      break
  }
})

function draw(){
  delta = pause.checked ? 0 : now() - prev
  prev = now()
  time = Math.max(0, time - delta)
  
  document.body.style.backgroundColor = 
    time === 0 ? '#faa' : // dead
    pause.checked ? '#abf' : // paused
    time <= 5000 ? '#bf8' : // tossup or late bonus
    '#8fb' // early bonus
    
  pause.nextElementSibling.textContent =
    pause.checked ? 'Play' : 'Pause'
  
  timer.value = (time/1000).toFixed(1)
  requestAnimationFrame(draw)
}
draw()
